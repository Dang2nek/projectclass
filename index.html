<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Đăng nhập lớp học</title>
</head>
<body>
  <h2>Đăng nhập lớp học</h2>
  <button id="loginBtn">Đăng nhập với Google</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    // ⚡ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCdui3CboK7OQxad__E-IuA9vSg7MtriCM",
      authDomain: "projectclass-81492.firebaseapp.com",
      projectId: "projectclass-81492",
      storageBucket: "projectclass-81492.appspot.com",
      messagingSenderId: "396285528683",
      appId: "1:396285528683:web:d0aea5d1fb08d85101ff2e",
      measurementId: "G-33W7MS5JDB"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    const TEACHER_CODE = "TEACHER123"; // Mã giáo viên

    document.getElementById("loginBtn").addEventListener("click", async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        console.log("Đăng nhập:", user.email);

        const code = prompt("Nếu bạn là giáo viên, nhập mã bí mật (bỏ trống nếu là học sinh):");

        if (code === TEACHER_CODE) {
          // Lưu vào collection teachers
          await setDoc(doc(db, "teachers", user.uid), {
            email: user.email,
            role: "teacher"
          });
          window.location.href = "https://teachers-x4og.onrender.com/";
        } else {
          // Lưu vào collection students
          await setDoc(doc(db, "students", user.uid), {
            email: user.email,
            role: "student"
          });
          window.location.href = "https://students-6fym.onrender.com/";
        }
      } catch (err) {
        console.error("Lỗi đăng nhập:", err);
        alert("Có lỗi xảy ra: " + err.message);
      }
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Class Web Login</title>
<script type="module">
  // Firebase SDK v9 module
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyANHvtLT4TpJW9C6qhmNdiIGYcbe5th_Yw",
    authDomain: "classweb-11389.firebaseapp.com",
    projectId: "classweb-11389",
    storageBucket: "classweb-11389.firebasestorage.app",
    messagingSenderId: "91367336185",
    appId: "1:91367336185:web:30a78cfe10e459b0605a28",
    measurementId: "G-7123YZQKWV"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  async function login() {
    try {
      const result = await signInWithPopup(auth, provider);
      const user = result.user;

      const code = prompt("Nhập mã giáo viên (nếu có):");

      if(code === "GV123"){  // ví dụ mã giáo viên
        // Teacher
        await setDoc(doc(db, "teachers", user.uid), {
          name: user.displayName,
          email: user.email,
          role: "teacher",
          loginAt: new Date()
        });
        alert("Chào giáo viên!");
        window.location.href = "https://teachers-x4og.onrender.com/";
      } else {
        // Student
        await setDoc(doc(db, "students", user.uid), {
          name: user.displayName,
          email: user.email,
          role: "student",
          loginAt: new Date()
        });
        alert("Chào học sinh!");
        window.location.href = "https://students-6fym.onrender.com/";
      }

    } catch(error) {
      console.error(error);
      alert("Đăng nhập thất bại!");
    }
  }
</script>
<style>
  body { font-family: Arial; background: #f0f2f5; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; }
  button { padding: 12px 24px; font-size: 18px; background-color: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; }
  button:hover { background-color: #45a049; }
</style>
</head>
<body>
  <h1>Class Web Login</h1>
  <button onclick="login()">Đăng nhập bằng Google</button>
</body>
</html>
